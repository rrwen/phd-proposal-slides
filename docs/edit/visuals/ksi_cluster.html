<!doctype html>

<meta charset="utf-8">
<title>KSI Cluster Map</title>

<div id="visual"></div>
<link rel="stylesheet" href="./node_modules/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="./node_modules/leaflet.markercluster/dist/MarkerCluster.css">
<link rel="stylesheet" href="./node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css">
<link rel="stylesheet" href="./visuals.css">

<style>
.leaflet-div-icon {
    stroke-color:  yellow;
    text-align:  center;
}
</style>

<script src="./node_modules/jquery/dist/jquery.min.js"></script>
<script src="./node_modules/leaflet/dist/leaflet.js"></script>
<script src="./node_modules/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>

$.getJSON( "data/toronto_ksi_2007to2017.geojson", function(data) {

	// (map) Create leaflet map
	var map = L.map('visual', {
		zoomControl: false
	});
	map.setView([43.71, -79.35], 12);

	// (map_base) Tile base map
	L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_nolabels/{z}/{x}/{y}{r}.png', {
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://carto.com/attributions">Carto</a>',
		subdomains: 'abcd',
		minZoom: 9,
		maxZoom: 15
	}).addTo(map);
	
	// (cluster) Create marker clusters
	var markers = L.markerClusterGroup({
		animateAddingMarkers: true
	});
	
	// (cluster_icon) Set marker icons
	var icon = L.icon({
		iconUrl: "./img/point.svg",
		iconSize: [10, 10]
	});
	
	// (cluster_markers) Cluster markers based on feature lon and lats
	var features = data.features;
	var f, lon, lat, latlon, m;
	for (let i in features) {
		setTimeout(function(){
			f = features[i];
			lon = f.geometry.coordinates[0];
			lat = f.geometry.coordinates[1];
			latlon = new L.LatLng(lat, lon);
			m = L.marker(latlon, {icon: icon});
			markers.addLayer(m);
		}, i * 100)
	}
	map.addLayer(markers);
});


</script>